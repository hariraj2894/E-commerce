{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{useLocation}from\"react-router-dom\";import axios from\"axios\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PaymentPage=()=>{const{state}=useLocation();const{cart=[],totalPrice=0}=state||{};const[paymentStatus,setPaymentStatus]=useState(null);const[address,setAddress]=useState(\"\");const[isAddressValid,setIsAddressValid]=useState(false);const artistId=cart[0][\"artisanId\"][\"_id\"];const[paid,setPaid]=useState(false);const userId=localStorage.getItem(\"user\");console.log('cart',artistId);const handlePayment=async()=>{if(typeof window.Razorpay===\"undefined\"){alert(\"Razorpay SDK failed to load. Please refresh the page.\");return;}try{const{data:razorpayOrder}=await axios.post(\"http://localhost:4000/api/create-order\",{amount:totalPrice*100// Amount in the smallest currency unit\n});const options={key:\"rzp_test_0DC1JJeT6tllnC\",// Replace with your Razorpay key\namount:razorpayOrder.amount,currency:\"INR\",order_id:razorpayOrder.id,name:\"Your Store Name\",description:\"Test Transaction\",handler:async response=>{const result=await axios.post(\"http://localhost:4000/api/confirm-payment\",{orderId:razorpayOrder.id,paymentId:response.razorpay_payment_id,signature:response.razorpay_signature});if(result.data.status===\"success\"){setPaid(true);alert(\"Payment successful!\");window.location.href=\"/\";}},prefill:{name:\"Your Name\",email:\"your-email@example.com\",contact:\"1234567890\"}};const paymentObject=new window.Razorpay(options);paymentObject.open();}catch(error){console.error(\"Error in payment:\",error);}};const productData=cart.map(item=>({productId:item._id,quantity:item.quantity,pname:item.name}));useEffect(()=>{if(paid){axios.post(\"http://localhost:4000/api/updateearned\",{artisianId:artistId,amount:totalPrice});axios.post(\"http://localhost:4000/api/usercart\",{userId,quantity:cart.length,productIds:productData,address});// console.log('response', response);\n}},[paid]);const handleAddressChange=e=>{const inputAddress=e.target.value;setAddress(inputAddress);const isValidAddress=/^[a-zA-Z0-9\\s,'-]{5,}$/.test(inputAddress);setIsAddressValid(isValidAddress);};return/*#__PURE__*/_jsxs(\"div\",{className:\"p-10 bg-gradient-to-r from-white to-gray-200 rounded-lg max-w-2xl mx-auto mt-12 shadow-xl font-sans\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-4xl font-bold text-center text-gray-800 mb-10 uppercase tracking-wider\",children:\"Payment Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col gap-5 mb-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold text-gray-800\",children:\"Cart Items\"}),cart.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No items in the cart\"}):cart.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center p-5 bg-white rounded-lg shadow-md hover:transform hover:translate-y-2 hover:shadow-lg transition\",children:[/*#__PURE__*/_jsx(\"img\",{src:item.image,alt:item.name,className:\"w-24 h-24 object-cover rounded-lg mr-5\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col gap-2\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-lg font-semibold text-gray-700\",children:item.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg text-gray-600\",children:[\"\\u20B9\",item.price]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-md text-gray-500\",children:[\"Quantity: \",item.quantity]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg text-red-600 font-semibold\",children:[\"Total: \\u20B9\",item.price*item.quantity]})]})]},item._id)),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 text-right text-xl font-semibold text-gray-800\",children:/*#__PURE__*/_jsxs(\"h3\",{children:[\"Total: \\u20B9\",totalPrice]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold text-gray-800\",children:\"Enter Your Address\"}),/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Enter your delivery address\",value:address,onChange:handleAddressChange,className:\"w-full p-3 mt-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400\"}),!isAddressValid&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 text-sm mt-2\",children:\"Please enter a valid address with at least 5 characters.\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handlePayment,className:\"\".concat(isAddressValid?\"bg-gradient-to-r from-purple-600 to-blue-500\":\"bg-gray-400 cursor-not-allowed\",\" text-white py-3 rounded-lg text-lg font-semibold hover:scale-105 transition\"),disabled:!isAddressValid,children:\"Pay Online\"}),paymentStatus&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xl text-center mt-6 font-semibold text-green-600\",children:paymentStatus})]});};export default PaymentPage;","map":{"version":3,"names":["React","useState","useEffect","useLocation","axios","jsx","_jsx","jsxs","_jsxs","PaymentPage","state","cart","totalPrice","paymentStatus","setPaymentStatus","address","setAddress","isAddressValid","setIsAddressValid","artistId","paid","setPaid","userId","localStorage","getItem","console","log","handlePayment","window","Razorpay","alert","data","razorpayOrder","post","amount","options","key","currency","order_id","id","name","description","handler","response","result","orderId","paymentId","razorpay_payment_id","signature","razorpay_signature","status","location","href","prefill","email","contact","paymentObject","open","error","productData","map","item","productId","_id","quantity","pname","artisianId","length","productIds","handleAddressChange","e","inputAddress","target","value","isValidAddress","test","className","children","src","image","alt","price","placeholder","onChange","onClick","concat","disabled"],"sources":["C:/Users/Admin/Downloads/new codes/Ecomerence/src/components/PaymentPage.jsx"],"sourcesContent":["import React, { useState ,useEffect} from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\n\r\nconst PaymentPage = () => {\r\n  const { state } = useLocation();\r\n  const { cart = [], totalPrice = 0 } = state || {};\r\n  const [paymentStatus, setPaymentStatus] = useState(null);\r\n  const [address, setAddress] = useState(\"\");\r\n  const [isAddressValid, setIsAddressValid] = useState(false);\r\n  const artistId = cart[0][\"artisanId\"][\"_id\"];\r\n  const [paid , setPaid] = useState(false);\r\n  const userId = localStorage.getItem(\"user\");\r\n\r\n  console.log('cart', artistId);\r\n  const handlePayment = async () => {\r\n    if (typeof window.Razorpay === \"undefined\") {\r\n      alert(\"Razorpay SDK failed to load. Please refresh the page.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const { data: razorpayOrder } = await axios.post(\"http://localhost:4000/api/create-order\", {\r\n        amount: totalPrice * 100, // Amount in the smallest currency unit\r\n      });\r\n      const options = {\r\n        key: \"rzp_test_0DC1JJeT6tllnC\", // Replace with your Razorpay key\r\n        amount: razorpayOrder.amount,\r\n        currency: \"INR\",\r\n        order_id: razorpayOrder.id,\r\n        name: \"Your Store Name\",\r\n        description: \"Test Transaction\",\r\n        handler: async (response) => {\r\n          const result = await axios.post(\"http://localhost:4000/api/confirm-payment\", {\r\n            orderId: razorpayOrder.id,\r\n            paymentId: response.razorpay_payment_id,\r\n            signature: response.razorpay_signature,\r\n          });\r\n          if (result.data.status === \"success\") {\r\n            setPaid(true);\r\n            alert(\"Payment successful!\");\r\n            window.location.href = \"/\";\r\n          }\r\n        },\r\n        prefill: {\r\n          name: \"Your Name\",\r\n          email: \"your-email@example.com\",\r\n          contact: \"1234567890\",\r\n        },\r\n      };\r\n\r\n      const paymentObject = new window.Razorpay(options);\r\n      paymentObject.open();\r\n    } catch (error) {\r\n      console.error(\"Error in payment:\", error);\r\n    }\r\n  };\r\n\r\n  const productData = cart.map(item => ({\r\n    productId: item._id, \r\n    quantity: item.quantity,\r\n    pname: item.name,\r\n  }));\r\n  useEffect(() => {\r\n    if (paid) {\r\n      axios.post(\"http://localhost:4000/api/updateearned\", { artisianId: artistId, amount: totalPrice });\r\n      axios.post(\"http://localhost:4000/api/usercart\", { userId, quantity: cart.length, productIds: productData, address })\r\n// console.log('response', response);\r\n    }\r\n  }, [paid]);\r\n  const handleAddressChange = (e) => {\r\n    const inputAddress = e.target.value;\r\n    setAddress(inputAddress);\r\n    const isValidAddress = /^[a-zA-Z0-9\\s,'-]{5,}$/.test(inputAddress);\r\n    setIsAddressValid(isValidAddress);\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-10 bg-gradient-to-r from-white to-gray-200 rounded-lg max-w-2xl mx-auto mt-12 shadow-xl font-sans\">\r\n      <h1 className=\"text-4xl font-bold text-center text-gray-800 mb-10 uppercase tracking-wider\">Payment Details</h1>\r\n      <div className=\"flex flex-col gap-5 mb-8\">\r\n        <h2 className=\"text-2xl font-semibold text-gray-800\">Cart Items</h2>\r\n        {cart.length === 0 ? (\r\n          <p>No items in the cart</p>\r\n        ) : (\r\n          cart.map((item) => (\r\n            <div key={item._id} className=\"flex items-center p-5 bg-white rounded-lg shadow-md hover:transform hover:translate-y-2 hover:shadow-lg transition\">\r\n              <img src={item.image} alt={item.name} className=\"w-24 h-24 object-cover rounded-lg mr-5\" />\r\n              <div className=\"flex flex-col gap-2\">\r\n                <p className=\"text-lg font-semibold text-gray-700\">{item.name}</p>\r\n                <p className=\"text-lg text-gray-600\">₹{item.price}</p>\r\n                <p className=\"text-md text-gray-500\">Quantity: {item.quantity}</p>\r\n                <p className=\"text-lg text-red-600 font-semibold\">Total: ₹{item.price * item.quantity}</p>\r\n              </div>\r\n            </div>\r\n          ))\r\n        )}\r\n        <div className=\"mt-4 text-right text-xl font-semibold text-gray-800\">\r\n          <h3>Total: ₹{totalPrice}</h3>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"mb-6\">\r\n        <h2 className=\"text-2xl font-semibold text-gray-800\">Enter Your Address</h2>\r\n        <textarea\r\n          placeholder=\"Enter your delivery address\"\r\n          value={address}\r\n          onChange={handleAddressChange}\r\n          className=\"w-full p-3 mt-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400\"\r\n        />\r\n        {!isAddressValid && <p className=\"text-red-500 text-sm mt-2\">Please enter a valid address with at least 5 characters.</p>}\r\n      </div>\r\n\r\n      <button\r\n        onClick={handlePayment}\r\n        className={`${isAddressValid ? \"bg-gradient-to-r from-purple-600 to-blue-500\" : \"bg-gray-400 cursor-not-allowed\"} text-white py-3 rounded-lg text-lg font-semibold hover:scale-105 transition`}\r\n        disabled={!isAddressValid}\r\n      >\r\n        Pay Online\r\n      </button>\r\n\r\n      {paymentStatus && <p className=\"text-xl text-center mt-6 font-semibold text-green-600\">{paymentStatus}</p>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PaymentPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}